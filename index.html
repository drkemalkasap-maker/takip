<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>My Items</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
<div id="container">
  <h1>Başlıklar</h1>
  <ul id="itemsList"></ul>
</div>

<script type="module">
import { checkAuth, userRootRef } from './firebaseConfig.js';
import { onValue, remove, child } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

const itemsList = document.getElementById("itemsList");
let currentUserId = null;

checkAuth(user => {
  currentUserId = user.uid;
  const rootRef = userRootRef(currentUserId);

  onValue(rootRef, snapshot => {
    itemsList.innerHTML = "";
    if (!snapshot.exists()) return;
    snapshot.forEach(childSnap => {
      const key = childSnap.key;
      const li = document.createElement('li');
      li.style.display = "flex";
      li.style.alignItems = "center";
      li.style.gap = "8px";

      const titleBtn = document.createElement('button');
      titleBtn.textContent = key;
      titleBtn.style.cursor = "pointer";
      titleBtn.addEventListener('click', () => {
        // İlk seviye path: sadece key
        window.location.href = `edit.html?id=${encodeURIComponent(key)}`;
      });

      const del = document.createElement('button');
      del.textContent = "Delete";
      del.addEventListener('click', (e) => {
        e.stopPropagation();
        if (!confirm(`"${key}" silinsin mi?`)) return;
        remove(child(rootRef, key));
      });

      li.appendChild(titleBtn);
      li.appendChild(del);
      itemsList.appendChild(li);
    });
  });

}, 'login.html');
</script>
</body>
</html>
